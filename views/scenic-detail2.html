<!DOCTYPE html>
<html lang="cn">
<head>
    <%-include("common/headinfo.html",{h_tit:'河北旅游电商资讯网_景区详情'})%>
</head>
<body>
<!--页头-->
<%-include("common/header.html")%>
<!-- 导航 -->
<%-include("common/nav.html")%>
<!--面包削-->
<div class="crumbs">
    <div class="js_curmbs center"></div>
</div>
    <div class="daq-ticket-detail">
        <div class="center">
            <!--图片介绍-->
            <div class="hotel-detail-top">

            </div>
            <!-- 门票价格详情 -->
            <!--<div class="daq-ticket-list">-->
                <!--<table class="ticket-class" border="1">-->

                <!--</table>-->
            <!--</div>-->
            <!--景点-->
            <div class="hotel-detail-price">
                <ul class="detail-nav">
                    <li class="active">
                        <a href="javascript:;" data-type="scenic">使用说明</a>
                    </li>
                    <li>
                        <a href="javascript:;" data-type="tips">费用包含</a>
                    </li>
                    <li>
                        <a href="javascript:;" data-type="trafiic">退款说明</a>
                    </li>
                    <!--<li>-->
                        <!--<a href="javascript:;" data-type="around">交通及周边</a>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<a href="javascript:;" data-type="exponent">大数据指数</a>-->
                    <!--</li>-->
                    <li>
                        <a href="javascript:;" data-type="comment">点评(条)</a>
                    </li>
                </ul>
            </div>

            <!-- 景点介绍 -->
            <div class="scenic clearfix" id="scenic">

            </div>
            <!-- 小贴士 -->
            <div class="hotel-detail-intro" id="tips">
                <h2 class="title">费用包含</h2>
                <p class="detail">

                </p>
            </div>
            <!-- 交通信息 -->
            <div class="hotel-detail-intro hotel-map" id="trafiic">
                <h2 class="title">退款说明 <i class="star"></i></h2>
                <div class="tkbox" style="padding: 24px;">
                </div>
            </div>

            <!-- 周边 -->
            <!--<div class="hotel-detail-intro" id="around">-->
                <!--<h2 class="title">交通及周边</h2>-->
                <!--<div class="daq-around">-->
                    <!--<div class="left-map" id="map-around">-->

                    <!--</div>-->
                    <!--<div class="right-name">-->
                        <!--<div class="title">-->
                            <!--<ul class="around-ul">-->
                                <!--<li class="active"  data-type="">-->
                                    <!--<i class="daq-icon">&#xe63a;</i>-->
                                    <!--<p>全部</p>-->
                                <!--</li>-->
                                <!--<li data-type="2">-->
                                    <!--<i class="daq-icon">&#xe6dc;</i>-->
                                    <!--<p>酒店</p>-->
                                <!--</li>-->
                                <!--<li data-type="4">-->
                                    <!--<i class="daq-icon">&#xe6d4;</i>-->
                                    <!--<p>购物</p>-->
                                <!--</li>-->
                                <!--<li data-type="3">-->
                                    <!--<i class="daq-icon">&#xe71b;</i>-->
                                    <!--<p>餐饮</p>-->
                                <!--</li>-->
                                <!--<li data-type="5">-->
                                    <!--<i class="daq-icon">&#xe710;</i>-->
                                    <!--<p>娱乐</p>-->
                                <!--</li>-->
                                <!--<li data-type="1">-->
                                    <!--<i class="daq-icon">&#xe6da;</i>-->
                                    <!--<p>景区</p>-->
                                <!--</li>-->
                            <!--</ul>-->
                            <!--<div class="intro-up"><span></span></div>-->
                            <!--<div class="intro-down"><span></span></div>-->
                        <!--</div>-->

                    <!--</div>-->
                    <!--<div class="around-hotel">-->
                        <!--<div class="top-title">-->
                            <!--<span>距该景区</span>-->
                            <!--<i class="active" data-value="5">5km</i>-->
                            <!--<i data-value="10">10km</i>-->
                            <!--<i data-value="15">15km</i>-->
                            <!--<i data-value="20">20km</i>-->
                        <!--</div>-->
                        <!--<ul class="bottom-hotel-name">-->

                        <!--</ul>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
            <!-- 大数据指数 -->
            <!--<div class="ticket-exponent" id="exponent">-->
                <!--<h2 class="title">大数据指数</h2>-->
                <!--<ul class="scenic-exponent">-->
                    <!--<li>-->
                        <!--<p class="num">86.95</p>-->
                        <!--<p class="name">旅游综合指数</p>-->
                        <!--<p class="star">-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe67c;</i>-->
                        <!--</p>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<p class="num">82.95</p>-->
                        <!--<p class="name">景区基本指数</p>-->
                        <!--<p class="star">-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe67c;</i>-->
                        <!--</p>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<p class="num">86.95</p>-->
                        <!--<p class="name">交通出行指数</p>-->
                        <!--<p class="star">-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe67c;</i>-->
                        <!--</p>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<p class="num">86.95</p>-->
                        <!--<p class="name">网上关注指数</p>-->
                        <!--<p class="star">-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe67c;</i>-->
                        <!--</p>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<p class="num">86.95</p>-->
                        <!--<p class="name">消费特征指数</p>-->
                        <!--<p class="star">-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe62c;</i>-->
                            <!--<i class="daq-icon">&#xe67c;</i>-->
                        <!--</p>-->
                    <!--</li>-->
                <!--</ul>-->
                <!--<div class="reception-number">-->
                    <!--<ul class="reception-hour">-->
                        <!--<li class="one-number">-->
                            <!--<p class="num">40996</p>-->
                            <!--<p class="name">最近一小时总接待量</p>-->
                        <!--</li>-->
                        <!--<li class="people-num">-->
                            <!--<p class="num">30920</p>-->
                            <!--<p class="name">省内游客</p>-->
                        <!--</li>-->
                        <!--<li class="people-num">-->
                            <!--<p class="num">10076</p>-->
                            <!--<p class="name">省外游客</p>-->
                        <!--</li>-->
                    <!--</ul>-->
                    <!--<ul class="reception-day">-->
                        <!--<li class="one-number">-->
                            <!--<p class="num">399107</p>-->
                            <!--<p class="name">今日累计新到客流量</p>-->
                        <!--</li>-->
                        <!--<li class="people-num">-->
                            <!--<p class="num">328368</p>-->
                            <!--<p class="name">省内游客</p>-->
                        <!--</li>-->
                        <!--<li class="people-num">-->
                            <!--<p class="num">116802</p>-->
                            <!--<p class="name">省外游客</p>-->
                        <!--</li>-->
                    <!--</ul>-->
                <!--</div>-->
                <!--<div class="people-number" >-->
                    <!--<div id="charts-wrap"></div>-->
                <!--</div>-->
            <!--</div>-->
            <!-- 点评 -->
            <div class="daq-comment" id="comment">
                <h2 class="title">点评</h2>
                <div class="comment-content">
                    <textarea name="" id="" cols="20" rows="10" placeholder="请输入评论内容..." class="write-comment" maxlength="255"></textarea>
                    <div class="my-comment">
                        <p class="sub-comment">
                            <span>我要评论</span>
                            <span>
                                <i class="daq-icon" data-value="1">&#xe67c;</i>
                                <i class="daq-icon" data-value="2">&#xe67c;</i>
                                <i class="daq-icon" data-value="3">&#xe67c;</i>
                                <i class="daq-icon" data-value="4">&#xe67c;</i>
                                <i class="daq-icon" data-value="5">&#xe67c;</i>
                            </span>
                        </p>
                        <div class="sub-right">
                            <!--<input type="text" placeholder="验证码" class="sub-y">-->
                            <!--<span><img src="image/yzm.jpg" alt=""></span>-->
                            <button class="btn updateCall">提交</button>
                        </div>
                    </div>
                    <div class="all-comment">
                        <p class="all-title">所有评论（共<span class="num"></span>条）</p>
                        <ul class="comment-list">
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--地图-->
    <p class="cover maskes mapnone cover01"></p>
    <div class="cover-content-box mapnone cover-content-word">
        <h3 class="hide cover-content-tit"><i></i>
            <span class="cover-tit">凯里主题公园游乐场</span>

            <a href="javascript:;" class="close-cover">×</a>
        </h3>
        <div id="buyMap" class="cover-con"></div>
    </div>
    <!--页尾-->
    <%-include("common/footer.html")%>
    <script src="http://filealiyun.geeker.com.cn/ued/BD-echarts/v3.8.4/echarts.min.js"></script>
    <script src="http://filealiyun.geeker.com.cn/ued/geek-widget/v1.0.0/platform-tool.js"></script>
    <script src="http://filealiyun.geeker.com.cn/ued/geek-echarts/v1.0.0/geek-echarts.js"></script>
<!--顶部图片列表-->
<script type="text/template" id="topImg">
    <div class="big-img fl">
        {{if list.length>0}}
        {{if list[0].url}}
        <img src="${list[0].url}" alt="">
        {{else}}
        <img src="image/zw.jpg" alt="">
        {{/if}}
        {{else}}
        <img src="image/zw.jpg" alt="">
        {{/if}}
    </div>
    <div class="all-img fl">
        <div class="inside-div">
            <ul class="scroll-ul">
                {{each(i) list}}
                <li><img src="${url}" alt=""></li>
                {{/each}}
            </ul>
            <div class="top daq-icon">&#xe6b0;</div>
            <div class="bottom daq-icon">&#xe6af;</div>
        </div>
    </div>
</script>
    <!--热门景区模板-->
<script type="text/template" id="topTemp">
    <h2 class="name">
        ${list.name}
        <p class="ticket-tips">
            {{if list.typeName}}
            <span>${list.typeName}</span>
            {{/if}}
        </p>
    </h2>
    <div class="hotel-dis clearfix">
        <div class="hotel-dis-left fl clearfix">

        </div>
        <div class="hotel-dis-rightb fr">
            <p class="title" title="${list.gullName}">${tools.ellipsisContent(list.gullName,22)}</p>
            <p class="cucum">产品编号:${list.id}</p>
            <div class="useinfo">
                <p class="title">费用不包含</p>
                <p class="font">${tools.ellipsisContent(list.feeExclude,50) || '暂无数据'}<span class="seemore">[ 查看详情 ]</span></p>
            </div>
            <div class="beprice">
                <span class="pricename">销售价格:</span><span class="price-icon">&yen;</span><span class="pricenum">${list.sellPrice}</span>起
            </div>
            <hr/>

            <ul class="hotel-bom-icon">

               <li>
                   <a href="ticketpayorder.html?channelCode=jqmp&code=jqmp&id=${list.id}" class="ydbtm">立即预订</a>
               </li>
                <!--<li class="enshrinebtn" data-id="${list.id}" data-title="${list.name}" data-content="使用说明：${ list.remind || '暂无数据' }" data-value="${list.vo.enshrine}">-->
                    <!--<span class="daq-icon">&#xe67c;</span>-->
                    <!--<span>收藏</span>-->
                <!--</li>-->
                <li class="pl_share">
                    <span class="daq-icon">&#xe652;</span>
                    <span>分享</span>
                    <label class="bdsharebuttonbox bdshare_t bds_tools_32" style="position: absolute;z-index: 10; top: -6px; display:  block; left: 0; width:0px; height:0px;" data-bd-bind="1471256152095">
                        <a class="bds_more" title="" data-img="" data-cmd="more" style="position: absolute;z-index:10; margin:0;padding:0;background: transparent;left: 0;top: 0px;width:90px;height:40px; display:inline-block; border: 0"></a>
                    </label>
                </li>
            </ul>
        </div>
    </div>
</script>
    <!--小贴士模板-->
<script type="text/template" id="tipsTemp">
    <div>{{html list.feeInfo || '赞无数据'}}</div>
</script>
<!--子景点模板-->
<script type="text/template" id="childScenicTemp">
    <ul class="scenic clearfix">
        {{each list}}
        <li class="clearfix">
            <div class="scenic-img">
                <img src="${cover || 'image/zw.jpg'}" alt="${name}">
            </div>
            <div class="scenic-intro">
                <h3>${name}</h3>
                <p class="summary" title="${introduce}">
                    ${tools.ellipsisContent(introduce,120) || '暂无数据'}
                </p>
                <a href="javascript:;" class="href-detail" data-value="${introduce}" data-name="${name}">查看详情</a>
            </div>
        </li>
        {{/each}}
    </ul>
    <!--分页 S-->
    <div class="page">
        <a class="first-page">首页</a>
        <a class="page-up">上一页</a>
        <a class="curr">1</a>
        <a>2</a>
        <a>3</a>
        <a>4</a>
        <a class="page-down">下一页</a>
        <a class="last-page">末页</a>
    </div>
</script>
<!--周边    -->
<script type="text/template" id="aroundTemp">
    <div>{{html list.refundInfo || '赞无数据'}}</div>
</script>
<!--门票列表    -->
<script type="text/template" id="productTemp">
    <tr>
        <td colspan="2">
            <div class="classify-name">
                <p class="name">产品名产</p>
                <p class="time">可预订时间</p>
                <p class="market-price">市场价</p>
                <p class="price">价格</p>
            </div>
        </td>
    </tr>
    {{each(i) list}}
    {{if mptype === 1}}
    <tr>
        {{if i === 0}}
        <td rowspan="${chengrenNum}" class="adult-ticket">
            ${title}
        </td>
        {{/if}}
        <td class="intro-list">
            <p class="name">${name}</p>
            <p class="btn"><a href="javascript:;" data-value="${remind}" class="seeproductinfo">查看说明</a></p>
            <p class="time">${enterSightLimitType}</p>
            <p class="market-price">￥${marketPrice}</p>
            <p class="price">￥<span>${sellPrice}</span></p>
            <p class="pay-btn">
                <a href="ticketpayorder.html?channelCode=jqmp&code=jqmp&id=${pid}" class="reserve">预订</a>
                <a href="ticketpayorder.html?channelCode=jqmp&code=jqmp&id=${pid}" class="pay-line">在线付</a>
            </p>
        </td>
    </tr>
    {{/if}}
    {{/each}}
    {{each(j) list2}}
    {{if mptype === 0}}
    <tr>
        {{if j === 0}}
        <td rowspan="${otherNum}" class="child-ticket">
            ${title}
        </td>
        {{/if}}
        <td class="intro-list">
            <p class="name">${name}</p>
            <p class="btn"><a href="javascript:;" data-value="${remind}" class="seeproductinfo">查看说明</a></p>
            <p class="time">${enterSightLimitType}</p>
            <p class="market-price">￥${marketPrice}</p>
            <p class="price">￥<span>${sellPrice}</span></p>
            <p class="pay-btn">
                <a href="ticketpayorder.html?channelCode=jqmp&code=jqmp&id=${pid}" class="reserve">预订</a>
                <a href="ticketpayorder.html?channelCode=jqmp&code=jqmp&id=${pid}" class="pay-line">在线付</a>
            </p>
        </td>
    </tr>
    {{/if}}
    {{/each}}
    {{each(j) list3}}
    {{if mptype === 3}}
    <tr>
        {{if j === 0}}
        <td rowspan="${otherNum}" class="child-ticket">
            ${title}
        </td>
        {{/if}}
        <td class="intro-list">
            <p class="name">${name}</p>
            <p class="btn"><a href="javascript:;" data-value="${remind}" class="">查看说明</a></p>
            <p class="time">${enterSightLimitType}</p>
            <p class="market-price">￥${marketPrice}</p>
            <p class="price">￥<span>${sellPrice}</span></p>
            <p class="pay-btn">
                <a href="ticketpayorder.html?channelCode=jqmp&code=jqmp&id=${pid}" class="reserve">预订</a>
                <a href="ticketpayorder.html?channelCode=jqmp&code=jqmp&id=${pid}" class="pay-line">在线付</a>
            </p>
        </td>
    </tr>
    {{/if}}
    {{/each}}
</script>
<!-- 景区介绍 -->
<script type="text/template" id="summaryTemp">
    {{html list.remind || '暂无数据' }}
</script>
<!--评论列表    -->
<script type="text/template" id="commentTemp">
    <ul class="comment-list">
        {{each(i) list}}
        <li class="item">
            <div class="user-head"><img src="${headPath || 'image/zw.jpg'}" alt=""></div>
            <div class="comment">
                <div class="title-cont">
                    <p class="name">${name || '暂无'}</p>
                    <p class="comment-star">
                        {{each(i) startNum}}
                        <i class="daq-icon">${startNum[i]}</i>
                        {{/each}}
                    </p>
                </div>
                <div class="time">${time || '暂无'}</div>
                <div class="content-dis">
                    ${comment || '暂无数据'}
                </div>
            </div>
        </li>
        {{/each}}
    </ul>
    <div class="page"></div>
</script>
<script>
    var indexJs = {
        init: function () {
            tools.setTowLevelBanner();
            this.scenic.id = tools.getUrlParams('id') ||tools.getUrlParams('rid')
            this.scenic.resourceCode = tools.getUrlParams('rid')
            this.getScenicDetail()// 获取景区详情

        },
        //景区基本信息
        scenic:{
            id:'',
            resourceCode:'',
            scenicInfo: {}
        },
        //子景点配置信息
        childrenParams: {
            page:1,
            limitPage: 5
        },
        // 周边信息配置
        around: {
            distance: 5, // 距离
            latitude: '', // 经度
            longitude: '', // 纬度
            sourceType:'' //资源类型
        },
        // 评论列表配置
        paramscomment:{
            page:1,
            limitPage:10,
            sourceType: 'ticket',
            reId:tools.getUrlParams('id')||tools.getUrlParams('rid'),
        },
        // 提交评论配置:
        updataComment: {
           star:0,
        },
        // 保存用户选择
        userPageConfig:{
            date:'',  // 设置的时间
            count:'1'  // 选择的数量,默认为1
        },
        // 获取站点图片列表
        getPicList: function() {
            var _this = this;
            var $imgTemp = $("#topImg");
            var $imgWrapper = $(".hotel-dis-left");
            $imgWrapper.empty();
            var loading = tools.loading($imgWrapper);
            var params = {
                url:'sitepicture/list',
                data:{
                    datatype:'sourceType_1'
                }
            }
            tools.request(params, function (res) {
                // console.log(res,8888)
                loading.clean();

                $imgTemp.tmpl({list: res.datas}).appendTo($imgWrapper);
                _this.setTopImageView(); //设置顶部图片鼠标移入预览
            })

        },

        // 获取景区详情
        getScenicDetail: function () {
            var _this = this;
            var $topTmpl = $("#topTemp");
            var $topWrapper = $('.hotel-detail-top');
            $topWrapper.empty();
            var loading = tools.loading($topWrapper);
            var params = {
                url: 'sceneryProduct/detail',
                data: {
                    id: _this.scenic.id,
                    resourceCode:_this.scenic.resourceCode
                }
            };
            tools.request(params, function(res){
                console.log(res,'门票详情')
                _this.scenic.id= res.data.id
                _this.paramscomment.sceneryId = res.data.id;
                loading.clean();
                /*分享*/
                tools.share();
                res.data.startNum= ['&#xe67c;','&#xe67c;','&#xe67c;','&#xe67c;','&#xe67c;'];
                for(var i=0; i< parseInt(res.data.commentLevel); i++) {
                    res.data.startNum[i]='&#xe62c;'
                }
                // 设置页面点评条数
                $('a[data-type=comment]').html('点评('+res.data.commentNum+')')
                switch(parseInt(res.data.commentLevel))
                {
                    case 0:
                        res.data.startName = '不满意'
                        break;
                    case 1:
                        res.data.startName = '不满意'
                        break;
                    case 2:
                        res.data.startName = '不满意'
                        break;
                    case 3:
                        res.data.startName = '一般'
                        break;
                    case 4:
                        res.data.startName = '非常满意'
                        break;
                    case 5:
                        res.data.startName = '非常满意'
                        break;
                    default:
                        res.data.startName = '暂无数据'
                        break;
                }
                _this.scenic.scenicInfo = res.data;

                // console.log(res.data)
                $topTmpl.tmpl({list: res.data}).appendTo($topWrapper);
                $('#summaryTemp').tmpl({list: res.data}).appendTo($('.scenic'));
                $('#tipsTemp').tmpl({list: res.data}).appendTo($('#tips .detail'));
                $('#aroundTemp').tmpl({list: res.data}).appendTo($('.tkbox'));
                // 费用不包含暂无数据时隐藏查看详情
                if(res.data.feeExclude.length<1){
                    $('.seemore').hide();
                }
                //收藏
                $('.enshrinebtn').click(function(){
                    var $this = $(this);
                    tools.setCollect({
                        selector:$this,
                        id: $this.attr('data-id'),
                        type: 'ticket',
                        content: $this.attr("data-content"),
                        title: $this.attr("data-title"),
                        active:"active",
                        num:$this.parent().find('.num')
                    });
                });
                //点赞
                var betoken = tools.getCookie('token')
                $('.pl_praised').click(function(){
                    var selector = $(this).eq(0);
                    var type = "praise";
                    var resourceType = 'sourceType_1';
                    var resourceId = $(this).attr("data-id");
                    var total=$(this).attr("data-hnum");
                    var title = $(this).attr('data-value')
                    var options = {
                        selector:selector,
                        total:total,
                        sourceType : resourceType,
                        reId : resourceId,
                        target :title,
                        token:betoken
                    };
                    tools.getInteraction(options,"en");
                });
                // 推荐
                $('.p1_recommend').click(function(){
                    var selector = $(this).eq(0);
                    var resourceType = 'ticket';
                    var resourceId = $(this).attr("data-id");
                    var total=$(this).attr("data-hnum");
                    var title = $(this).attr('data-value')
                    var options = {
                        selector:selector,
                        sourceType : resourceType,
                        reId : resourceId,
                        target :title,
                        token:betoken
                    };
                    tools.getRecommend(options,"en");
                });
                _this.getPicList();// 顶部图片序列

                // _this.getScenicProduct(res.data.resourcecode); // 获取景区门票
                // _this.setBaiduMap(); // 设置百度地图
                // _this.setAroundMap(); //设置周边地图
                // _this.setBigData(); //设置大数据页面
                _this.seeFullSummary(); //查看景区简介全部
                // _this._mapEventBind(); // 查看地图
                // _this.getSceneryChildren(_this.childrenParams); //获取子景点
                _this.columnJumpIn(); // 栏目跳转
                // _this.getScenciTips();//获取小贴士
                // _this._getNearListInfo(); //周边信息
                _this.getComment() //获取评论列表
                _this.updateCall(); //提交用户评论
            });
        },
        //设置顶部图片鼠标移入预览
        setTopImageView: function () {
            $(".scroll-ul li").mouseover(function () {
                var $src = $(this).find("img").attr("src")
                $(".big-img").find("img").attr("src",$src)
            });
            $('.bottom').on('click',function () {
                var $box = $('.inside-div')
                var leng = $('.inside-div li').length
                var $h = parseInt($box.css('marginTop'))
                if($h == -(leng-5)*88 || leng <= 5 ){
                    return false
                }
                $box.stop().css('marginTop',$h-88 + 'px').css("transition","all .1s");
            });
            // 监控滚动条 选中对应栏目
            var detailnav = [];
            for(var i =0;i<$('.detail-nav li').length;i++) {
                detailnav.push($('.detail-nav li').eq(i).find('a').attr('data-type'))
            }
            $(window).scroll(function () {
                bescroll = $(window).scrollTop();
                for(var i= 0;i < detailnav.length; i++) {
                    if(bescroll > $('#'+detailnav[i]).offset().top-120) {
                        $('.detail-nav li').eq(i).addClass("active").siblings().removeClass('active')
                    }
                }
            });

            $('.top').on('click',function () {
                var $box = $('.inside-div')
                var $h = parseInt($box.css('marginTop'))
                var leng = $('.inside-div li').length
                if($h == 0){
                    return false
                }
                if(leng <= 5 ){
                    return false
                }
                $box.stop().css('marginTop',$h+88 + 'px').css("transition","all .1s");
            });
        },
        //查看景区简介全部
        seeFullSummary: function () {
            var _this = this;
            $('.seemore').click(function () {
                $.dialog({
                    title: _this.scenic.scenicInfo.gullName,
                    message: _this.scenic.scenicInfo.feeExclude,
                    width: 700,
                    height: 300,
                    mask: true,
                    footer: false
                });
            })
        },
        // 设置地图 在地图上放置图标
        setMap: function(long, lat, name, mapname) {
            // 百度地图API功能
            var map = new BMap.Map(mapname);
            var point = new BMap.Point(long,lat);
            map.centerAndZoom(point, 18);
            map.enableScrollWheelZoom();   //启用滚轮放大缩小，默认禁用
            // 将标注添加到地图中
            var opts = {
                position : point,    // 指定文本标注所在的地理位置
                offset   : new BMap.Size(0, -20)    //设置文本偏移量
            };
            var label = new BMap.Label("<div style='color: #fff;background:url(image/icon-bg.png);width: 110px;height: 30px;line-height: 30px;padding-left: 22px;'>"+tools.ellipsisContent(name,6)+"</div>", opts);  // 创建文本标注对象
            label.setStyle({
                color : "#fff",
                fontSize : "14px",
//            height : "30px",
//            width:"100px",
                background:"rgba(255,255,255,0)",
                border:"none",
                fontFamily:"微软雅黑"
            });
            map.addOverlay(label);
            //创建新图标
            var myIcon = new BMap.Icon("image/add-icon.png", new BMap.Size(26,34));
            var marker2 = new BMap.Marker(point,{icon:myIcon});  // 创建标注
            map.addOverlay(marker2);
        },
        // 设置地图  地址查看地图
        _setMap: function (long, lat, address) {
            // 百度地图API功能
            var map = new BMap.Map("buyMap", {
                enableMapClick: false
            });
            map.centerAndZoom(new BMap.Point(long, lat), 18);
            map.enableScrollWheelZoom();
            // 复杂的自定义覆盖物
            function ComplexCustomOverlay(point, text) {
                this._point = point;
                this._text = text;
            }

            ComplexCustomOverlay.prototype = new BMap.Overlay();
            ComplexCustomOverlay.prototype.initialize = function (map) {
                this._map = map;
                var div = this._div = document.createElement("div");
                div.className = "map-icon-add maskes";
                div.style.position = "absolute";
                div.style.zIndex = BMap.Overlay.getZIndex(this._point.lat);
                div.style.border = "none";
                div.style.color = "white";
                div.style.height = "18px";
                div.style.whiteSpace = "nowrap";
                div.style.MozUserSelect = "none";
                div.style.fontSize = "12px";
                div.setAttribute("title", this._text);
                var span = this._span = document.createElement("span");
                span.setAttribute("class", "hide");
                div.appendChild(span);
                span.appendChild(document.createTextNode(this._text));
                var arrow = this._arrow = document.createElement("div");
                arrow.style.background = "url(image/tri.png) no-repeat";
                arrow.style.position = "absolute";
                arrow.style.width = "10px";
                arrow.style.height = "5px";
                arrow.style.bottom = "-5px";
                arrow.style.left = "50%";
                arrow.style.marginLeft = "-5px";
                arrow.style.overflow = "hidden";
                div.appendChild(arrow);
                map.getPanes().labelPane.appendChild(div);

                return div;
            };
            ComplexCustomOverlay.prototype.draw = function () {
                var map = this._map;
                var pixel = map.pointToOverlayPixel(this._point);
                this._div.style.left = (pixel.x - 25) - parseInt(this._arrow.style.left) + "px";
                this._div.style.top = pixel.y - 55 + "px";
            };
            var myCompOverlay = new ComplexCustomOverlay(new BMap.Point(long, lat), address);

            map.addOverlay(myCompOverlay);
            function addMarker(point) {
                var myIcon = new BMap.Icon("image/buy-point.png", new BMap.Size(26, 32), {
                    anchor: new BMap.Size(0, 0)
                });
                var marker = new BMap.Marker(point, {icon: myIcon});
                map.addOverlay(marker);
            }

            var markPoint = new BMap.Point(long, lat);
            addMarker(markPoint);
        },
        // 地图事件
        _mapEventBind: function () {
            var _this = this;
            // 地图
            $(".hotel-add").on("click", "a", function () {
                $(".cover01,.cover-content-box").show();
                var long = _this.scenic.scenicInfo.longitude;
                var lat = _this.scenic.scenicInfo.latitude;
                var name = _this.scenic.scenicInfo.name;;
                $('.cover-tit').html(name);
                _this._setMap(long, lat, name);
            });
            $(".cover-content-box .close-cover,.cover01").click(function () {
                $(".cover01,.cover-content-box").hide();
            });
        },
        // 获取子景点信息
        getSceneryChildren: function (option) {
            var _this = this;
            var $childrenScenicTmpl = $("#childScenicTemp");
            var $scenicWrapper = $('.scenic');
            $scenicWrapper.empty();
            var loading = tools.loading($scenicWrapper);
            var params = {
                url: 'scenery/children',
                data: {
                    page: option.page || 1,
                    limitPage: option.limitPage || '5',
                    sceneryId: _this.scenic.id,
                    resourceCode:_this.scenic.resourceCode
                }
            };
            tools.request(params, function(res) {
                loading.clean();
                if (res.code === 0) {
                    if (res.datas && res.datas.length > 0) {
                        $childrenScenicTmpl.tmpl({list: res.datas}).appendTo($scenicWrapper);
                        //  初始化分页
                        var option = {
                            total: res.page.totalPage,
                            currPage: res.page.currPage,
                            click: function (data) {
                                _this.childrenParams.page = data.page;
                                $(window).scrollTop(0);
                                _this.getSceneryChildren();
                            }
                        };
                        tools.pageTurn(option);
                        $('.href-detail').click(function () {
                            var summary = $(this).data('value');
                            var name = $(this).data('name');
                            $.dialog({
                                title: name,
                                message: summary,
                                width: 700,
                                height: 300,
                                mask: true,
                                footer: false
                            });
                        })
                    } else {
                        $scenicWrapper.html(tools.NO_DATA);
                    }
                } else {
                    $scenicWrapper.html(tools.TRY_REFRESH);
                }

            })
        },
        //栏目跳转
        columnJumpIn: function () {
            //点击到指定位置
            var needPos = $(".detail-nav li");
            needPos.click(function () {
                needPos.removeClass("active");
                $(this).addClass("active");
                var dataType = $(this).find('a').attr("data-type");
                if($('.detail-nav').hasClass("curr")){
                    $('html,body').animate({scrollTop: $("#" + dataType + "").offset().top-46}, 200);
                }else{
                    $('html,body').animate({scrollTop: $("#" + dataType + "").offset().top-92}, 200);
                }
            });
            /*详情页面内容tit滚动判断固定位置*/
            var Scrolltop = $(".detail-nav").offset().top;
            $(window).scroll(function(){
                var bodyScrolltop = document.documentElement.scrollTop + document.body.scrollTop;
                if(bodyScrolltop >= Scrolltop){
                    $(".detail-nav").addClass('curr');
                }else if(bodyScrolltop < Scrolltop){
                    $(".detail-nav").removeClass('curr');
                }
            });
        },
        //获取景区小贴士
        getScenciTips: function () {
            var _this = this;
            var $tipsTmpl = $("#tipsTemp");
            var $tipsWrapper = $('#tips .detail');
            $tipsWrapper.empty();
            var loading = tools.loading($tipsWrapper);
            var params = {
                url: 'scenery/listTip',
                data: {
                    sceneryId: this.scenic.id
                }
            };
            tools.request(params, function(res){
                loading.clean();
                // console.log(res.datas)
                if (res.code === 0) {
                    if (res.datas && res.datas.length > 0) {
                        $tipsTmpl.tmpl({list: res.datas}).appendTo($tipsWrapper);
                    } else {
                        $tipsWrapper.html(tools.NO_DATA);
                    }
                } else {
                    $tipsWrapper.html(tools.TRY_REFRESH);
                }
            })
        },
        // 请求周边信息列表
        _getNearListInfo: function () {
            var _this = this;
            var $aroundTemp = $("#aroundTemp");
            var $aroundWrapper = $('.bottom-hotel-name');
            $aroundWrapper.empty();
            var loading = tools.loading($aroundWrapper);
            var params = {
                url: 'scenery/around',
                data: this.around
            };
            tools.request(params, function(res){
                loading.clean();
                if (res.code === 0) {
                    if (res.datas && res.datas.length > 0) {
                        $aroundTemp.tmpl({list: res.datas}).appendTo($aroundWrapper);
                    } else {
                        $aroundWrapper.html(tools.NO_DATA);
                    }
                } else {
                    $aroundWrapper.html(tools.TRY_REFRESH);
                }
                /**
                 * 点击资源,地图显示对应的地点
                 */
                $(".bottom-hotel-name>li").off().on('click',function () {
                    $(this).addClass('curr').siblings().removeClass('curr');
                    var long = $(this).attr("data-long");
                    var lat = $(this).attr("data-lat");
                    var name = $(this).attr("data-name");
                    $(this).parent("li").addClass("curr").siblings("li").removeClass("curr");
                    _this.setMap(long,lat,name,'map-around');
                });
                /**
                 * 点击距离,筛选资源
                 */
                $('.top-title').find('i').off().on('click', function () {
                    var scenicKm = $(this).attr('data-value')
                    $(this).addClass('active').siblings().removeClass('active')
                    _this.around.distance = scenicKm;
                    _this._getNearListInfo();
                })
                /**
                 * 点击类型 筛选资源
                 */
                $('.around-ul>li').off().on('click',function () {
                    $(this).addClass('active').siblings().removeClass('active');
                    var scenicType = $(this).attr('data-type');
                    _this.around.sourceType = scenicType;
                    _this._getNearListInfo();
                })
                /**
                 * 周边资源类型 上下选择
                 */
                $('.right-name .intro-down').on('click',function () {
                    $('.around-ul').css('marginTop','-93px');
                    $(this).css('display','none');
                    $('.right-name .intro-up').css('display','block');
                });
                $('.right-name .intro-up').on('click',function () {
                    $('.around-ul').css('marginTop','0px');
                    $(this).css('display','none');
                    $('.right-name .intro-down').css('display','block');
                });
            })
        },
        // 获取景区门票信息
        getScenicProduct: function (resourcecode) {
            var _this = this;
            var $productTemp = $("#productTemp");
            var $productWrapper = $('.ticket-class');
            $productWrapper.empty();
            var loading = tools.loading($productWrapper);
            var params = {
                url: 'scenery/relatedProducts',
                data: {
                    type:0,
                    resourcecode: resourcecode
                }
            };
            tools.request(params, function(res){
                loading.clean();
                // console.log(res)
                if (res.code === 0) {
                    if (res.datas && res.datas.length > 0) {
                        var chengrenNum=0;
                        var otherNum=0;
                        var otherNum2=0;
                        var ohterObj = [];
                        var ohterObj2 = [];
                        for(var i = 0; i <res.datas.length; i++) {
                            if(res.datas[i].companyType === '成人票') {
                                chengrenNum+=1;
                                res.datas[i].mptype = 1;
                            }else if(res.datas[i].companyType === '学生票/老人票') {
                                otherNum+=1;
                                res.datas[i].mptype = 0;
                                ohterObj.push(res.datas[i])
                            }else{
                                otherNum2+=1;
                                res.datas[i].mptype = 3;
                                ohterObj2.push(res.datas[i])
                            }
                        }
                        $productTemp.tmpl({list: res.datas,chengrenNum:chengrenNum,otherNum:otherNum,list2:ohterObj,list3:ohterObj2}).appendTo($productWrapper);
                        $('.seeproductinfo').on('click',function () {
                            var info = $(this).attr('data-value');
                            $.dialog({
                                title: '门票说明',
                                message: info,
                                width: 700,
                                height: 300,
                                mask: true,
                                footer: false
                            });
                        })
                    } else {
                        $productWrapper.html(tools.NO_DATA);
                    }
                } else {
                    $productWrapper.html(tools.TRY_REFRESH);
                }
            })
        },
        //获取评论列表
        getComment:function() {
            var _this = this;
            var $commentTmpl = $("#commentTemp");
            var $commentWrapper = $('.comment-list');
            $commentWrapper.empty();
            var loading = tools.loading($commentWrapper);
            var sendParams={
                url:'comment/getCommentInfo',
                data:_this.paramscomment,
                method: 'GET'
            };
            tools.request(sendParams,function(res){
                loading.clean();

                if(res.code===0){
                    if(res.datas.length>0){
                        $('.all-title .num').html(res.datas.length);
                        for(var i = 0; i< res.datas.length; i++) {
                            res.datas[i].startNum= ['&#xe67c;','&#xe67c;','&#xe67c;','&#xe67c;','&#xe67c;'];
                            for(var j=0; j< parseInt(res.datas[i].star); j++) {
                                res.datas[i].startNum[j]='&#xe62c;'
                            }
                        }
                        // console.log(res.datas,9999)
                        $commentTmpl.tmpl({list: res.datas}).appendTo($commentWrapper);
                        //分页
                        var totalPage = 1;
                        if(res.page){
                            totalPage = res.page.totalPage;
                        }
                        tools.pageTurn({
                            selector: '.page',
                            total: totalPage,
                            currPage: _this.paramscomment.page,
                            limits: 3,
                            click: function(paramscomment){
                                $("body,html").scrollTop(0);
                                getComment(paramscomment);
                            },
                            paramscomment:_this.paramscomment
                        });
                    }else{
                        $('.all-title .num').html(0);
                        $commentWrapper.html(tools.NO_DATA);
                    }
                }else{
                    $commentWrapper.html(tools.TRY_REFRESH);
                }

            })
    },
        // 提交用户评论
        updateCall: function() {
            var $submit = $('.updateCall');
            var _this = this;
            var star = 0
            _this.setCommentStar();// 设置评论等级
            $submit.click(function () {
                var $content =$('.write-comment').val();
                if($content === ''){
                    $.dialog({
                        title: "友情提示",
                        message: "请填写评论后提交",
                        width: 400,
                        height: 200,
                        mask: true,
                        footer: false
                    });
                    return;
                }
                // 获取用户登录的token
                var betoken = tools.getCookie('token')
                if(betoken) {
                    tools.request({
                        url:'/comment/saveComment',
                        data:{
                            sourceType:'ticket',
                            reId: _this.scenic.id,
                            comment:$content,
                            target:_this.scenic.scenicInfo.name,
                            token:tools.getCookie('token'),
                            star:_this.updataComment.star,
                            // pics:pics
                        }
                    },function(result){
                        if(result.code === 0){
                            $.dialog({
                                title: '成功',
                                message: '评论成功,等待审核',
                                width: 400,
                                height: 200,
                                mask: true,
                                footer: false
                            });
                            $('.opabox').css('display','none');
                            $('.comment-content').find('textarea').val('')
                            $('.sub-comment').find('span').eq(1).html('<i class="daq-icon" data-value="1"></i><i class="daq-icon" data-value="2"></i><i class="daq-icon" data-value="3"></i><i class="daq-icon" data-value="4"></i><i class="daq-icon" data-value="5"></i>')
                        }else{
                            $.dialog({
                                title: '友情提示',
                                message: result.message,
                                width: 400,
                                height: 200,
                                mask: true,
                                footer: false
                            });
                            $('.comment-content').find('textarea').val('')
                            $('.sub-comment').find('span').eq(1).html('<i class="daq-icon" data-value="1"></i><i class="daq-icon" data-value="2"></i><i class="daq-icon" data-value="3"></i><i class="daq-icon" data-value="4"></i><i class="daq-icon" data-value="5"></i>')
                        }
                    })
                }else {
                    window.location.href = "login.html";
                }
            })
        },
        // 设置评论等级 星星
        setCommentStar: function () {
            /**
             * 选择评论星级
             */
            var _this = this;
            $('.sub-comment i').on('click',function () {
                var starNum = $(this).attr('data-value')
                // console.log(starNum)
                _this.updataComment.star = starNum;
                switch (starNum) {
                    case '1':
                        $('.sub-comment').html('<span>我要评论</span>\n' +
                            '                            <span>\n' +
                            '                                <i class="daq-icon" data-value="1">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="2">&#xe67c;</i>\n' +
                            '                                <i class="daq-icon" data-value="3">&#xe67c;</i>\n' +
                            '                                <i class="daq-icon" data-value="4">&#xe67c;</i>\n' +
                            '                                <i class="daq-icon" data-value="5">&#xe67c;</i>\n' +
                            '                            </span>')
                        _this.setCommentStar();
                        break;
                    case '2':
                        $('.sub-comment').html('<span>我要评论</span>\n' +
                            '                            <span>\n' +
                            '                                <i class="daq-icon" data-value="1">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="2">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="3">&#xe67c;</i>\n' +
                            '                                <i class="daq-icon" data-value="4">&#xe67c;</i>\n' +
                            '                                <i class="daq-icon" data-value="5">&#xe67c;</i>\n' +
                            '                            </span>')
                        _this.setCommentStar();
                        break;
                    case '3':
                        $('.sub-comment').html('<span>我要评论</span>\n' +
                            '                            <span>\n' +
                            '                                <i class="daq-icon" data-value="1">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="2">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="3">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="4">&#xe67c;</i>\n' +
                            '                                <i class="daq-icon" data-value="5">&#xe67c;</i>\n' +
                            '                            </span>')
                        _this.setCommentStar();
                        break;
                    case '4':
                        $('.sub-comment').html('<span>我要评论</span>\n' +
                            '                            <span>\n' +
                            '                                <i class="daq-icon" data-value="1">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="2">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="3">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="4">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="5">&#xe67c;</i>\n' +
                            '                            </span>')
                        _this.setCommentStar();
                        break;
                    case '5':
                        $('.sub-comment').html('<span>我要评论</span>\n' +
                            '                            <span>\n' +
                            '                                <i class="daq-icon" data-value="1">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="2">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="3">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="4">&#xe62c;</i>\n' +
                            '                                <i class="daq-icon" data-value="5">&#xe62c;</i>\n' +
                            '                            </span>')
                        _this.setCommentStar();
                        break;
                }
            })
        }
    }
    $(function() {
        indexJs.init();
    })
</script>
</body>
</html>
